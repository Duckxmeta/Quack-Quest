<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #f0f0f0;
        }
        .health-bar-inner {
            transition: width 0.5s ease-in-out;
        }
        .duck-sprite {
            width: 120px;
            height: 120px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            image-rendering: pixelated; /* Helps keep pixel art crisp */
        }
        .attack-animation {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .type-fire { background-color: #F08030; color: white; }
        .type-water { background-color: #6890F0; color: white; }
        .type-grass { background-color: #78C850; color: white; }
        .type-normal { background-color: #A8A878; color: white; }
    </style>
</head>
<body class="bg-gray-800 text-white flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-4xl mx-auto bg-gray-900 border-4 border-gray-700 rounded-lg shadow-lg p-4">
        
        <!-- Battle Screen -->
        <div id="battle-scene" class="grid grid-cols-1 gap-4">
            <!-- Opponent Area -->
            <div class="text-right">
                <div class="inline-block bg-gray-700 p-2 rounded-lg border-2 border-gray-600 w-full max-w-sm ml-auto">
                    <div class="flex justify-between items-center">
                        <div class="text-lg" id="opponent-name">Stray Kitty</div>
                        <div class="text-sm">HP: <span id="opponent-hp-text">45/45</span></div>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-4 mt-1 border border-black">
                        <div id="opponent-hp-bar" class="bg-green-500 h-full rounded-full health-bar-inner" style="width: 100%"></div>
                    </div>
                </div>
                <div class="flex justify-end mt-2">
                    <div id="opponent-sprite" class="duck-sprite"></div>
                </div>
            </div>

            <!-- Player Area -->
            <div>
                 <div class="flex justify-start mb-2">
                    <div id="player-sprite" class="duck-sprite"></div>
                </div>
                <div class="inline-block bg-gray-700 p-2 rounded-lg border-2 border-gray-600 w-full max-w-sm mr-auto">
                    <div class="flex justify-between items-center">
                        <div class="text-lg" id="player-name">Decent Duck</div>
                        <div class="text-sm">HP: <span id="player-hp-text">55/55</span></div>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-4 mt-1 border border-black">
                        <div id="player-hp-bar" class="bg-green-500 h-full rounded-full health-bar-inner" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message and Controls -->
        <div id="ui-panel" class="mt-4 border-4 border-gray-700 rounded-lg p-4 h-32 flex">
            <!-- Message Log -->
            <div id="message-log" class="w-1/2 text-lg flex items-center justify-center text-center">
                What will Decent Duck do?
            </div>

            <!-- Action Buttons -->
            <div id="action-buttons" class="w-1/2 grid grid-cols-2 gap-4">
                <button onclick="showMoveSelection()" class="bg-red-600 hover:bg-red-700 p-4 rounded-lg border-2 border-red-800 text-center">Fight</button>
                <button onclick="showSwitchSelection()" class="bg-blue-600 hover:bg-blue-700 p-4 rounded-lg border-2 border-blue-800 text-center">Switch</button>
            </div>

            <!-- Move Selection -->
            <div id="move-selection" class="hidden w-1/2 grid grid-cols-2 gap-4">
                <!-- Move buttons will be generated here by JS -->
            </div>

            <!-- Switch Selection -->
            <div id="switch-selection" class="hidden w-1/2 grid grid-cols-2 gap-4">
                 <!-- Switch buttons will be generated here by JS -->
            </div>
        </div>

    </div>
    
    <!-- Game Over Modal -->
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg text-center border-4 border-gray-600">
            <h2 id="game-over-message" class="text-3xl mb-4"></h2>
            <button onclick="location.reload()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-xl">Play Again</button>
        </div>
    </div>


    <script>
        // --- GAME DATA AND CLASSES ---

        const TYPE_CHART = {
            'Fire': {'Fire': 0.5, 'Water': 0.5, 'Grass': 2.0, 'Normal': 1.0},
            'Water': {'Fire': 2.0, 'Water': 0.5, 'Grass': 0.5, 'Normal': 1.0},
            'Grass': {'Fire': 0.5, 'Water': 2.0, 'Grass': 0.5, 'Normal': 1.0},
            'Normal': {'Fire': 1.0, 'Water': 1.0, 'Grass': 1.0, 'Normal': 1.0},
        };

        class Move {
            constructor(name, type, power) {
                this.name = name;
                this.type = type;
                this.power = power;
            }
        }

        class Duck {
            constructor(name, type, maxHp, attack, defense, speed, moves, color, imageUrl = null) {
                this.name = name;
                this.type = type;
                this.maxHp = maxHp;
                this.currentHp = maxHp;
                this.attack = attack;
                this.defense = defense;
                this.speed = speed;
                this.moves = moves;
                this.isFainted = false;
                this.color = color; // For sprite color fallback
                this.imageUrl = imageUrl; // For sprite image
            }

            takeDamage(damage) {
                this.currentHp -= damage;
                if (this.currentHp <= 0) {
                    this.currentHp = 0;
                    this.isFainted = true;
                }
            }
        }

        class Player {
            constructor(name, team) {
                this.name = name;
                this.team = team;
                this.activeDuck = team[0];
            }

            switchDuck(index) {
                if (index >= 0 && index < this.team.length && !this.team[index].isFainted) {
                    this.activeDuck = this.team[index];
                    return true;
                }
                return false;
            }

            hasLost() {
                return this.team.every(duck => duck.isFainted);
            }
        }

        // --- GAME SETUP ---
        
        // 1. Create Moves
        const peck = new Move("Peck", "Normal", 10);
        const webbedScratch = new Move("Webbed Scratch", "Normal", 9);
        const spicyCrumb = new Move("Spicy Crumb", "Fire", 12);
        const quackInferno = new Move("Quack Inferno", "Fire", 15);
        const pondSpit = new Move("Pond Spit", "Water", 12);
        const featherJet = new Move("Feather Jet", "Water", 14);
        const pondweedSlap = new Move("Pondweed Slap", "Grass", 12);
        const sharpReed = new Move("Sharp Reed", "Grass", 15);

        // 2. Create Players and their Teams
        const player = new Player("You", [
            new Duck("Decent Duck", "Grass", 55, 10, 14, 8, [peck, pondweedSlap, sharpReed], 'bg-green-500 border-green-700', 'https://i.imgur.com/K7CdYVS.png'),
            new Duck("Puddle Paddler", "Water", 50, 12, 12, 10, [peck, pondSpit, featherJet], 'bg-blue-500 border-blue-700')
        ]);
        const opponent = new Player("Rival Drake", [
            new Duck("Stray Kitty", "Fire", 45, 14, 10, 12, [webbedScratch, spicyCrumb, quackInferno], 'bg-red-500 border-red-700', 'https://i.imgur.com/D54Prdv.png'),
            new Duck("Bread Fiend", "Normal", 65, 15, 15, 7, [peck, webbedScratch], 'bg-yellow-500 border-yellow-700')
        ]);

        // --- UI AND BATTLE LOGIC ---

        let isBattleInProgress = false;

        // DOM Elements
        const messageLog = document.getElementById('message-log');
        const actionButtons = document.getElementById('action-buttons');
        const moveSelection = document.getElementById('move-selection');
        const switchSelection = document.getElementById('switch-selection');

        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        function updateUI() {
            // Player UI
            document.getElementById('player-name').textContent = player.activeDuck.name;
            const playerHpPercentage = (player.activeDuck.currentHp / player.activeDuck.maxHp) * 100;
            const playerHpBar = document.getElementById('player-hp-bar');
            playerHpBar.style.width = `${playerHpPercentage}%`;
            playerHpBar.className = `h-full rounded-full health-bar-inner ${getHpBarColor(playerHpPercentage)}`;
            document.getElementById('player-hp-text').textContent = `${player.activeDuck.currentHp}/${player.activeDuck.maxHp}`;
            const playerSprite = document.getElementById('player-sprite');
            if (player.activeDuck.imageUrl) {
                playerSprite.style.backgroundImage = `url('${player.activeDuck.imageUrl}')`;
                playerSprite.className = 'duck-sprite'; // Remove color classes
            } else {
                playerSprite.style.backgroundImage = 'none';
                playerSprite.className = `duck-sprite ${player.activeDuck.color}`;
            }

            // Opponent UI
            document.getElementById('opponent-name').textContent = opponent.activeDuck.name;
            const opponentHpPercentage = (opponent.activeDuck.currentHp / opponent.activeDuck.maxHp) * 100;
            const opponentHpBar = document.getElementById('opponent-hp-bar');
            opponentHpBar.style.width = `${opponentHpPercentage}%`;
            opponentHpBar.className = `h-full rounded-full health-bar-inner ${getHpBarColor(opponentHpPercentage)}`;
            document.getElementById('opponent-hp-text').textContent = `${opponent.activeDuck.currentHp}/${opponent.activeDuck.maxHp}`;
            const opponentSprite = document.getElementById('opponent-sprite');
             if (opponent.activeDuck.imageUrl) {
                opponentSprite.style.backgroundImage = `url('${opponent.activeDuck.imageUrl}')`;
                opponentSprite.className = 'duck-sprite'; // Remove color classes
            } else {
                opponentSprite.style.backgroundImage = 'none';
                opponentSprite.className = `duck-sprite ${opponent.activeDuck.color}`;
            }
        }
        
        function getHpBarColor(percentage) {
            if (percentage > 50) return 'bg-green-500';
            if (percentage > 20) return 'bg-yellow-500';
            return 'bg-red-500';
        }

        async function displayMessage(message, duration = 1500) {
            messageLog.textContent = message;
            await wait(duration);
        }

        function showActionButtons() {
            messageLog.textContent = `What will ${player.activeDuck.name} do?`;
            actionButtons.style.display = 'grid';
            moveSelection.style.display = 'none';
            switchSelection.style.display = 'none';
        }

        function showMoveSelection() {
            actionButtons.style.display = 'none';
            moveSelection.style.display = 'grid';
            moveSelection.innerHTML = '';
            player.activeDuck.moves.forEach(move => {
                const moveBtn = document.createElement('button');
                const typeClass = `type-${move.type.toLowerCase()}`;
                moveBtn.className = `p-2 rounded-lg border-2 text-center text-sm ${typeClass}`;
                moveBtn.textContent = move.name;
                moveBtn.onclick = () => playerAction({ action: 'move', move });
                moveSelection.appendChild(moveBtn);
            });
             const backBtn = document.createElement('button');
             backBtn.className = 'bg-gray-500 hover:bg-gray-600 p-2 rounded-lg border-2 border-gray-700 text-center text-sm col-span-2';
             backBtn.textContent = 'Back';
             backBtn.onclick = showActionButtons;
             moveSelection.appendChild(backBtn);
        }
        
        function showSwitchSelection(forceSwitch = false) {
            actionButtons.style.display = 'none';
            switchSelection.style.display = 'grid';
            switchSelection.innerHTML = '';
            player.team.forEach((duck, index) => {
                const switchBtn = document.createElement('button');
                const typeClass = `type-${duck.type.toLowerCase()}`;
                switchBtn.className = `p-2 rounded-lg border-2 text-center text-sm ${typeClass}`;
                switchBtn.textContent = `${duck.name} (${duck.currentHp}/${duck.maxHp})`;
                
                if (duck.isFainted || duck === player.activeDuck) {
                    switchBtn.disabled = true;
                    switchBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
                
                switchBtn.onclick = () => {
                    if (forceSwitch) {
                        handleForcedSwitch(index);
                    } else {
                        playerAction({ action: 'switch', index });
                    }
                };
                switchSelection.appendChild(switchBtn);
            });

            if (!forceSwitch) {
                const backBtn = document.createElement('button');
                backBtn.className = 'bg-gray-500 hover:bg-gray-600 p-2 rounded-lg border-2 border-gray-700 text-center text-sm col-span-2';
                backBtn.textContent = 'Back';
                backBtn.onclick = showActionButtons;
                switchSelection.appendChild(backBtn);
            }
        }

        async function playerAction(choice) {
            if (isBattleInProgress) return;
            isBattleInProgress = true;
            
            const aiChoice = { action: 'move', move: opponent.activeDuck.moves[0] };

            const playerGoesFirst = player.activeDuck.speed >= opponent.activeDuck.speed;
            const turnOrder = playerGoesFirst 
                ? [{attacker: player, defender: opponent, choice: choice}, {attacker: opponent, defender: player, choice: aiChoice}]
                : [{attacker: opponent, defender: player, choice: aiChoice}, {attacker: player, defender: opponent, choice: choice}];

            for (const turn of turnOrder) {
                if (turn.attacker.activeDuck.isFainted || turn.defender.activeDuck.isFainted) {
                    continue;
                }
                await executeTurn(turn.attacker, turn.defender, turn.choice);
                if (player.hasLost() || opponent.hasLost()) {
                    endBattle();
                    return;
                }
            }
            
            showActionButtons();
            isBattleInProgress = false;
        }
        
        async function executeTurn(attacker, defender, choice) {
             if (choice.action === 'switch') {
                attacker.switchDuck(choice.index);
                await displayMessage(`${attacker.name} sent out ${attacker.activeDuck.name}!`);
                updateUI();
             } else if (choice.action === 'move') {
                const move = choice.move;
                await displayMessage(`${attacker.activeDuck.name} used ${move.name}!`);

                const typeMultiplier = TYPE_CHART[move.type]?.[defender.activeDuck.type] ?? 1.0;
                let message = '';
                if (typeMultiplier > 1) message = "It's super effective!";
                if (typeMultiplier < 1) message = "It's not very effective...";
                if (message) await displayMessage(message, 1000);

                const baseDamage = ((attacker.activeDuck.attack * move.power) / defender.activeDuck.defense) / 5;
                const randomFactor = Math.random() * (1.1 - 0.9) + 0.9;
                const damage = Math.max(1, Math.floor(baseDamage * randomFactor * typeMultiplier));
                
                const defenderSprite = (defender === player) ? document.getElementById('player-sprite') : document.getElementById('opponent-sprite');
                defenderSprite.classList.add('attack-animation');
                
                defender.activeDuck.takeDamage(damage);
                updateUI();
                await displayMessage(`${defender.activeDuck.name} took ${damage} damage!`);
                
                defenderSprite.classList.remove('attack-animation');

                if(defender.activeDuck.isFainted) {
                    await displayMessage(`${defender.activeDuck.name} has fainted!`);
                    if (defender.hasLost()) return;

                    if (defender === player) {
                        await displayMessage("You must choose a new duck.");
                        showSwitchSelection(true);
                    } else {
                        await displayMessage(`${defender.name} is choosing a new duck...`);
                        const nextDuckIndex = defender.team.findIndex(d => !d.isFainted);
                        defender.switchDuck(nextDuckIndex);
                        updateUI();
                        await displayMessage(`${defender.name} sent out ${defender.activeDuck.name}!`);
                    }
                }
             }
        }
        
        async function handleForcedSwitch(index) {
            player.switchDuck(index);
            updateUI();
            await displayMessage(`Go, ${player.activeDuck.name}!`);
            isBattleInProgress = false;
            showActionButtons();
        }

        function endBattle() {
            const modal = document.getElementById('game-over-modal');
            const message = document.getElementById('game-over-message');
            if (player.hasLost()) {
                message.textContent = "You Lost! Better luck next time.";
            } else {
                message.textContent = "You Won! You're the top duck!";
            }
            modal.style.display = 'flex';
        }

        window.onload = () => {
            updateUI();
            displayMessage("A wild duck battle begins!", 2000);
        };
    </script>
</body>
</html>
